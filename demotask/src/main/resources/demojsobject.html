<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JS Object Demo</title>
</head>
<body>

<h1>Input Object Details</h1>
<textarea id="input" rows="20" cols="100">
{
  "id": "1",
  "name": "Jeans",
  "price": 49,
  "tags": ["S", "M", "L", "XL"],
  "product details":
    {
        "color": "blue",
        "item attrib": ["pant", "denim"]
    }
}
</textarea>
<br>
<button type="button" onclick="process()">Submit</button>

<h3>Output</h3>
<pre id="output"></pre>

<script>
    class Product {
        constructor({id, name, price, tags, details}) {
             this.id = id;
             this.name = name;
             this.price = price;
             this.tags = tags;
             this.details = details;
             this.updatedAt = null;
        }

     // update recursively
     update(value) {
         if (typeof value === "string") {
            return "new-" + value;
         }
         if (typeof value === "number") {
            return value + 1;
         }
         if (Array.isArray(value)) {
            return value.map(v => this.update(v));
         }
         if (value && typeof value === "object") {
             const obj = {};
             for (const k in value) {
                 obj[k] = this.update(value[k]);
             }
             return obj;
         }
         return value;
     }

     // validate fields
     validate() {
         const errors = {};

         if (typeof this.id !== "string") {
            errors.id = "id must be a string";
         }
         if (!this.name || typeof this.name !== "string") {
            errors.name = "name must be non-empty string";
         }
         if (typeof this.price !== "number") {
            errors.price = "price must be numeric";
         }
         if (!Array.isArray(this.tags)) {
            errors.tags = "tags must be an array";
         }
         return Object.keys(errors).length > 0 ? { valid: false, errors } : { valid: true };
     }

     // update
     processUpdate() {
         const validation = this.validate();
         if (!validation.valid){
            return {
                details: validation.errors
            };
         }

         const updatedOutput =
                {
                    id: this.id // don't change
                };

         for (const k of ["name", "price", "tags", "details"]) {
             if (this[k] !== undefined) {
                 updatedOutput[k] = this.update(this[k]);
             }
         }

         updatedOutput.updatedAt = Math.floor(Date.now() / 1000);
         return updatedOutput;
     }
 }

    function process() {
            // read input
            const userInput = JSON.parse(document.getElementById("input").value);

            // map the fields
            const product = new Product({
                id: userInput.id,
                name: userInput.name,
                price: userInput.price,
                tags: userInput.tags,
                details: userInput["product details"]
            });

            // update
            const output = product.processUpdate();

            // print
            document.getElementById("output").textContent = JSON.stringify(output);
    }

</script>

</body>
</html>
