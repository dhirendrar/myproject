<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JS Object Demo</title>
</head>
<body>

<h1>Input Object Details</h1>
<textarea id="input" rows="20" cols="100">
{
  "id": "1",
  "name": "Jeans",
  "price": 49,
  "tags": ["S", "M", "L", "XL"],
  "product details":
    {
        "color": "blue",
        "item attrib": ["pant", "denim"]
    }
}
</textarea>
<br>
<button type="button" onclick="process()">Submit</button>

<h3>Output</h3>
<pre id="output"></pre>

<script>
    const update = function update(value) {
        if (typeof value === "string") {
            return "new-" + value;
        }
        if (typeof value === "number") {
            return value + 1;
        }
        if (Array.isArray(value)) {
            return value.map(update);
        }
        if (value && typeof value === "object") {
            const obj = {};
            for (const k in value){
                obj[k] = update(value[k]);
            }
            return obj;
        }
        return value;
    }

    function validateInput(input) {
        const errors = {};

        if(typeof input.id === "undefined") {
            errors.id = "id field is missing";
        } else if (typeof input.id !== "string") {
            errors.id = "id must be a string";
        }

        if (!("name" in input)) {
            errors.name = "name field is missing";
        } else if (typeof input.name !== "string" || input.name.trim() === "") {
            errors.name = "name must be non-empty string";
        }

        if (!("price" in input)) {
            errors.price = "price field is missing";
        } else if (typeof input.price !== "number") {
            errors.price = "price must be numeric";
        }

        if (!("tags" in input)) {
            errors.tags = "tags field is missing";
        } else if (!Array.isArray(input.tags)) {
            errors.tags = "tags must be an array";
        }

        return Object.keys(errors).length > 0 ? { valid: false, errors } : { valid: true };
    }

    function processInput(input) {
        const result = validateInput(input);
        if (!result.valid) {
            return {
                error: result.errors
            };
        }

        const updatedOutput = {};
        for (const k in input) {
            if(k === "id") {
                updatedOutput[k] = input[k];
             } else {
                updatedOutput[k] = update(input[k]);
            }
        }
        updatedOutput.updatedAt = Math.floor(Date.now() / 1000);

        return updatedOutput;
    }

    function process() {
        const input = JSON.parse(document.getElementById("input").value);
        const output = processInput(input);
        document.getElementById("output").textContent = JSON.stringify(output);
    }

</script>

</body>
</html>
